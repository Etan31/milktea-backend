<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Profile</title>

  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; padding: 20px; }
    h1 { color: #2c3e50; }

    .card {
      background: white; padding: 20px; border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1); max-width: 400px;
    }
    .profile-field { margin: 10px 0; font-size: 16px; }
    .profile-field span { font-weight: bold; color: #27ae60; }

    .btn { margin: 10px 8px 10px 0; padding: 10px 15px; border: none; border-radius: 6px;
      color: white; cursor: pointer; }
    .btn.back { background: #8e44ad; }
    .btn.logout { background: #e74c3c; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

  <!-- Buttons -->
  <button class="btn back" onclick="goBack()">â¬… Back to Admin Dashboard</button>
  <button class="btn logout" onclick="logout()">ðŸšª Logout</button>

  <h1>ðŸ‘¤ Admin Profile</h1>

  <div class="card">
    <div class="profile-field"><span>Name:</span> <span id="adminName">Loading...</span></div>
    <div class="profile-field"><span>Email:</span> <span id="adminEmail">Loading...</span></div>
    <div class="profile-field"><span>Contact:</span> <span id="adminContact">Loading...</span></div>
    <div class="profile-field"><span>Role:</span> <span id="adminRole">Loading...</span></div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

  // ðŸ”¥ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCpXS9lRDsfHGzLwnT2YFFPM3bRU_6E3r0",
    authDomain: "e-library-bdbb1.firebaseapp.com",
    databaseURL: "https://e-library-bdbb1-default-rtdb.firebaseio.com",
    projectId: "e-library-bdbb1",
    storageBucket: "e-library-bdbb1.appspot.com",
    messagingSenderId: "721888979016",
    appId: "1:721888979016:web:fe65826bc262189a11107d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // ======================================================
  // âœ… CHECK USER AUTH + CHECK ROLE = "admin"
  // ======================================================
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      Swal.fire("Unauthorized!", "You must login first.", "error")
        .then(() => window.location.href = "login.html");
      return;
    }

    // Fetch user data
    const userRef = ref(db, "users/" + user.uid);
    const snap = await get(userRef);

    if (!snap.exists()) {
      Swal.fire("Error", "Profile not found in database.", "error")
        .then(() => window.location.href = "login.html");
      return;
    }

    const data = snap.val();

    // âŒ IF USER IS NOT ADMIN, BLOCK ACCESS
    if (data.role !== "admin") {
      Swal.fire("ðŸš« Access Denied", "Only admins can access this page.", "error")
        .then(() => window.location.href = "homepage.html");
      return;
    }

    // âœ… Show admin details
    document.getElementById("adminName").textContent = data.fullName || "N/A";
    document.getElementById("adminEmail").textContent = data.email || "N/A";
    document.getElementById("adminContact").textContent = data.phone || "N/A";
    document.getElementById("adminRole").textContent = data.role || "admin";
  });

  // ======================================================
  // âœ” Back button
  // ======================================================
  window.goBack = () => {
    window.location.href = "admin.html";
  };

  // ======================================================
  // âœ” Logout
  // ======================================================
  window.logout = () => {
    signOut(auth).then(() => {
      Swal.fire("Logged out", "", "success").then(() => {
        window.location.href = "login.html";
      });
    });
  };
</script>

</body>
</html>
